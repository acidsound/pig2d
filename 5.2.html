<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />

    <title>  </title>

    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="libs/pig2d/css/core.css" />

    <!--제이쿼리가 종속성 관계에서 가장 높은 위치이다 그래서 맨먼저 쓴다-->
    <script src="libs/jquery.js"></script>

    <!--백본은 제이쿼리 다음에 포함시키는것이 건강에 이롭다 -->
    <script src="libs/backbone/underscore.js"></script>
    <script src="libs/backbone/json2.js"></script>
    <script src="libs/backbone/backbone.js"></script>


    <!--pig2d 엔진은 제이쿼리와 백본에 종속적이므로 맨 나중에 쓴다-->
    <script src="libs/pig2d/js/core.js"></script>
    <script src="libs/pig2d/js/node2d.js"></script>

    <script>

        $(function() {

            var nodes = [];

            //노드생성
            var node = new Pig2d.node(
                    {
                        el : $('#bone-templ').clone(),
                        model : new Pig2d.model()
                    }
            );
            node.get('model').setPosition(100,150);
            $('.pig2d-fullscreen').append(node.get('el'));
            node.show(true);
            nodes.push(node);

            //클로닝
            var clone_node = node.clone();
            clone_node.get('model').setPosition(50,50);
            node.add(clone_node);

            //$('.pig2d-fullscreen').append(clone_node.get('el'));
            clone_node.show(true);
            nodes.push(clone_node);

            //전체 업데이트
            for(var index in nodes)  {
                nodes[index].update();
            }

            //이벤트처리
            document.addEventListener( 'mousedown', onDocumentMouseDown, false );

            function onDocumentMouseDown( event ) {

                event.preventDefault();

                document.addEventListener( 'mousemove', onDocumentMouseMove, false );
                document.addEventListener( 'mouseup', onDocumentMouseUp, false );

            }

            function onDocumentMouseMove( event ) {

                var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
                var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

                node.get('model').rotate(movementX);
                clone_node.get('model').rotate(movementY);

                //전체 업데이트
                for(var index in nodes)  {
                    nodes[index].update();
                }

            }

            function onDocumentMouseUp( event ) {

                document.removeEventListener( 'mousemove', onDocumentMouseMove );
                document.removeEventListener( 'mouseup', onDocumentMouseUp );

            }


        });

    </script>

</head>

<body>

<div class="pig2d-fullscreen" >
</div>

<div class='pig2d-templet' style="visibility: hidden">
    <div id="bone-templ" style="
    background-color: blue;
    width:6px;

    -webkit-transform :translate(100px,100px)">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1"
             style="position: absolute;
         -webkit-transform :translate(6px,0px) rotate(180deg);"
                >
            <polygon points="0,0 6,100 6,0"
                     style="fill:red;"/>
            <line x1="0" y1="0" x2="6" y2="0"
                  style="stroke:rgb(255,255,0);stroke-width:1"/>
        </svg>

    </div>
</div>




</body>
</html>